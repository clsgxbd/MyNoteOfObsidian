微服务组件使用
nacos
	作用: 
		注册中心
		配置中心
	使用: 
		启动nacos服务
		引入依赖
		配置文件 bootstrap.properties
		添加启动类注解 @EnableDiscoveryClient
gateway
	作用:
		网关 跨域 鉴权 全局过滤器
	使用: 
		引入依赖
		配置文件 开启路由功能 在nacos
	gateway是什么时候执行的:
		通过域名到时候找到80端口,找到gateway服务, 然后通过路由规则负载均衡给其它模块
openFeign
	作用: 
		远程调用, 简化HttpClient 可以像调用本地方法一样进行远程调用
	使用:
		引入依赖
		调用方
			@EnableFeignClients(basePackages={"com.xxx"})
		使用方
			@FeignClient(value = "service-xxx", fallback = XxxDegradeFeignClient.class)
sentinel
	作用: 
		熔断 降级 限流
	使用
		配合OpenFeign
		fallback = XxxDegradeFeignClient.class


四. 后台商品管理模块(练习代码基本功)
三级分类
	一级分类表
	二级分类表 中包含一级分类id
	三级分类表 中包含二级分类id
	面试题: 你们的三级分类用了几张表? 3张, 可以用一张吗?可以, pId字段
品牌
	三级分类表
	品牌表
	中间表 为什么要有中间表: 品牌和三级分类是多对多的关系, 设计表结构的时候首先应该先判断关系, 一对一, 一对多, 多对对
	拿到需求: 
		第一步设计表结构, 
		第二步写model实体类pojo和vo, 
		第三步写Controller和Service先返回假数据, 最后进行实现
平台属性和平台属性值
	表结构设计
		base_attr_info
		base_attr_value
		实际开发中: 先判断如果是空就直接返回, 尽量不要if嵌套, 最多嵌套三层
	具体接口实现
spu和sku
	Spu srandard product unit  标准化产品单元
	Sku stock keeping unit 库存量单位
spu销售属性和销售属性值

rabbitmq
	作用
		流量削峰
		异步处理
		解耦服务
	组成部分
		生产者
		消费者
		交换机
		队列
		routing kye
		binging
		broker服务
	rabbitmq消息模型
		简单模型 : 一对一, 一个生产者 队列 一个消费者
		工作模型: 一对多 一个生产者 队列 多个消费者
		发布订阅模型: 
			路由模型 fanout
			定向投递 direct
			通配投递 topic
				excalidraw.com 画图工具
面试题: 
	防止消息的重复消费
		幂等性? 就是用户对于统一操作发起的一次请求或者多次请求多次的结果是一致的
		怎么保证幂等性?
			set和setnx的区别
			setnx可以
			set不可以
			redisson框架
			用MySQL设置一个唯一值(夯筑: 代码有问题导致大量请求落到mysql, 导致MySQL夯筑了)
		怎么保证消息不丢失(怎么保证消息的准确性)
商品详情模块
	juc下面的异步编排技术 CompletableFuture
	CompletableFuture的几个方法
	CompletableFuture的合并操作没有返回值, 所以需要用map或者list手动封装返回值, 返回给前端
	线程池的七大核心参数
redis缓存技术
	redis三大问题
		缓存穿透: 访问value为null的
			缓存null值, 最终解决: 布隆过滤器
		缓存雪崩: 多个key同时失效
			设置随机过期时间
		缓存击穿: 热点key失效问题
			第一种: 锁
				synchronized lock ==> 本地jvm锁 底层调用native方法调用C或C++的方法
			第二种: redis实现分布式锁 --调研的第二种方案 ( 高并发 , 多线程场景)
				加锁: setnx 
					问题一: 死锁处理: 加一个过期时间 setnx  k  v  ttl
					问题二: 删除不是自己的那把锁 - 加唯一标识 uuid : setnx  k  uuid  ttl 
				释放锁
					首先判断这把锁是不是自己持有的, uuid 和redis里面的值是否一样, 一样才可以删除, 有没有问题? 
						问题: 判断成功了,但是因为各种原因,这时候卡顿了, 正在这时, 过期了, 然后再进释放锁操做, 就把别人的锁给释放了, (没有保证原子性)
						解决方案: lua脚本
			第三种: redisson
				lock.trylock()
				lock.unlokck()
			第四种: 终极方案:AOP+redis/redisson
				为什么要用这种方式: 
					解决代码复用
					解耦,便于后期维护
				怎么实现?
					第一步: 自定义一个注解 @GmallCache 通过@interface实现
					第二步: 定义一个切面类 通过@Aspect
					第三步: 通过@annotation绑定 
						命名空间绑定 
					环绕通知/环绕增强@Around("@annotation(com.xxx.xxx.xxx)")
					ProceedingJoinPoint配合aound使用
					joinPoint.proceed(args); 调用此方法 执行原有的核心业务方法
					上来可以先不要写最终的代码, 可以先试一下
		首页
			首页特点
				访问量大
				相对固定, 展示商品不经常变动
			页面静态化
			Thymeleaf技术
			使用静态化的好处
				访问速度快
				解决高并发 nginx实现静态化, 进行静态资源部署
				有哪些方式可以实现页面静态化
					Thymeleaf
					nginx
					<mark>定时脚本, 按照公司的需求去定时生成一个静态页面输出到nginx指定的位置, 把老的页面替换一下即可</mark>
			@Scheduled(cron = "0/10 * * * * ?") 实现定时脚本注解 
			Java定时任务: 秒分时日月星期
			linux定时任务: 分时日月星期
	七. 搜索
		什么是ES 
			文档数据, 惊醒关键字查询
			ELK 
				elasticsearch 搜索引擎
				logstash 日志收集
				kibana 可视化客户端
			es-head 使用 测试环境使用
		MySQL与Elasticsearch对比
| MySQL | Elasticsearch |
| - | - | 
| 数据库(databases)   |   索引库(index) |
|表结构(table)     |      映射(mapping) |
| 记录(row)        |       文档(document) |
| 字段(colume)      |      字段(field) |
| 查询语句(sql)      |      查询语句(dsl) |
		业务实现
			引入依赖
			创建mapping(我们自己定义一个结构)
			创建index
			创建数据( 数据是怎么来的 )
				上下架
			展示数据
				dsl
		热点数据的更新
			商品详情页点击一次, 热度就加1 频率很高, 如果每一次我们就去更新一下ex压力很大, 可以十次存一下
			goods中商品的热度字段更新方式?
				redis数据类型存储热度字段: zset
	常见面试题
		elasticsearch版本是什么?
			7.8
		es倒排索引
			什么是正排索引: 
				以文本作为key, 以分词作为values , 通过文本去查分词
			什么是倒排索引: 
				以分词作为key, 以文本作为values, 通过分词去查询文本
		<mark>怎么保证数据库的es的一致性</mark>
			实时性: mq发送消息
				业务中实现
					我们项目中上下架 功能用到了, 使用了mq技术
					耦合业务
				<mark>非业务中实现(这个答对就稳了, 下来后自己总结一下)</mark>
							监听binlog日志 (运维同时 一般使用go / python语言 把binlog日志同步到 kafka/rabbitmq )
							Java工程师单独的开发一个微服务模块 binlog-consumer, 消费消息同步到es
			非实时性: 数据报表, 统计面板, 季度 年度报告 年终报告
				怎么实现?
					logstash + mysql ==> 同步到es

八. 单点登录
	登录业务
		登录过程
		登录流程图
	老师写的: 
		![](image/Pasted%20image%2020221226164109.png)
		我自己写的: 
				前端传过来用户名密码
				查询数据库是否存在该用户, 
				存在
				生成一个token
				得到nickName
				redis存token
				返回token和nickName给前端
	跨域
		![](image/Pasted%20image%2020221226164238.png)
	认证业务
		GlobalFilter全局过滤器实现: 所有的url请求首先找到我们的gateway进而找到GlobalFilter, 做一些校验功能, 之后进行路由转发
		认证流程
			获取url请求
			判断inner内部接口
			获取用户id和临时用户id, 判断用户是否登录, 鉴权 ip地址判断(防止伪造)
			判断auth接口
			判断白名单页面
			把用户id和临时id添加到请求头header里面(为什么呢? Cookie不能跨域)



如何解决用户通过浏览器回退重复提交订单?
进入结算页面时,生成一个结算流水号, 然后保存到结算页面的隐藏元素中, 每次用户提交都检查该流水号于页面提交的是否相符, 订单保存后吧后台的流水号删除掉. 那么第二次用户用同一个页面提交的化流水号就会匹配失败, 无法重复保存订单. 

验证库存与价格是否有变动
因为与其它模块没有耦合, 所以可以通过异步编排提高效率




